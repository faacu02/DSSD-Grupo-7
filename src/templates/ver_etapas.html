<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Etapas del Proyecto</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<style>
		.navbar-custom { background: rgba(255,255,255,0.95); backdrop-filter: blur(6px); }
		.card-hero { box-shadow: 0 6px 20px rgba(0,0,0,0.06); }
		.etapa-row:hover { background: rgba(0,0,0,0.02); }
	</style>
</head>
<body class="bg-light">
	<nav class="navbar navbar-expand-lg navbar-light navbar-custom">
		<div class="container">
			<a class="navbar-brand fw-bold text-primary" href="{{ url_for('formulario.index') }}">
				<i class="fas fa-project-diagram me-2"></i>ProjectPlanning
			</a>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ms-auto">
					<li class="nav-item">
						<a class="nav-link" href="{{ url_for('formulario.formulario_nombre') }}">
							<i class="fas fa-plus-circle me-1"></i>Nuevo Proyecto
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link text-danger" href="{{ url_for('login.logout') }}">
							<i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesi√≥n
						</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container my-5">
		<div class="row justify-content-center">
			<div class="col-12 col-lg-10">
				<div class="card card-hero shadow-sm">
					<div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
						<h5 class="mb-0">
							<i class="fas fa-layer-group me-2"></i>
							Etapas del proyecto
							{% if proyecto and proyecto.nombre %}
								- {{ proyecto.nombre }}
							{% endif %}
						</h5>
						<div class="d-flex gap-2">
							<form method="POST"
								action="{{ url_for('formulario.marcar_como_completado', proyecto_id=proyecto_id) }}">
								<input type="hidden" name="proyecto_id" value="{{ proyecto.id }}">
								<input type="hidden" name="case_id" value="{{ case_id }}">
								<button type="submit" class="btn btn-success btn-sm">
									<i class="fas fa-check-circle me-1"></i>Completar proyecto
								</button>
							</form>

						<a href="{{ url_for('formulario.index') }}" class="btn btn-outline-light btn-sm">
							<i class="fas fa-arrow-left me-1"></i>Volver
						</a>
					</div>
					<div class="card-body">
						{% if etapas and etapas|length > 0 %}
							<div class="table-responsive">
								<table class="table table-hover align-middle">
									<thead class="table-light">
										<tr>
											<th>Nombre</th>
											<th>Tipo</th>
											<th>Fecha inicio</th>
											<th>Fecha fin</th>
											<th class="text-end">Acciones</th>
										</tr>
									</thead>
									<tbody>
										{% for etapa in etapas %}
											<tr class="etapa-row">
												<td>{{ etapa.nombre }}</td>
												<td class="text-capitalize">{{ etapa.tipo_cobertura or '-' }}</td>
												<td>{{ etapa.fecha_inicio or '-' }}</td>
												<td>{{ etapa.fecha_fin or '-' }}</td>
												<td class="text-end">
													<!-- Asumo que existe una vista para detalle de etapa en el blueprint 'etapa'.
														 Si el nombre de la ruta es distinto, actualizar el url_for correspondiente. -->
													<a href="{{ url_for('etapa.detalle_etapa', etapa_id=etapa.id, case_id=case_id, etapa_cloud_id=etapa.etapa_cloud_id) }}" class="btn btn-sm btn-outline-primary me-2">
														<i class="fas fa-eye me-1"></i>Ver detalle
													</a>
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>
						{% else %}
							<div class="text-center py-5">
								<i class="fas fa-info-circle fa-2x text-muted"></i>
								<p class="mt-3 text-muted">No hay etapas registradas para este proyecto.</p>
                            </div>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
