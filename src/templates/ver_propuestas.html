<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Propuestas de Donación</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<style>
		.navbar-custom { background: rgba(255,255,255,0.95); backdrop-filter: blur(6px); }
		.card-hero { box-shadow: 0 6px 20px rgba(0,0,0,0.06); }
		.row-hover:hover { background: rgba(0,0,0,0.02); }
	</style>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body class="bg-light">

	<!-- NAVBAR -->
	<nav class="navbar navbar-expand-lg navbar-light navbar-custom">
		<div class="container">
			<a class="navbar-brand fw-bold text-primary" href="{{ url_for('formulario.index') }}">
				<i class="fas fa-project-diagram me-2"></i>ProjectPlanning
			</a>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ms-auto">
					<li class="nav-item">
						<a class="nav-link" href="{{ url_for('formulario.formulario_nombre') }}">
							<i class="fas fa-plus-circle me-1"></i>Nuevo Proyecto
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link text-danger" href="{{ url_for('login.logout') }}">
							<i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesión
						</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container my-5">
		{% include "messages.html" %}

		<div class="row justify-content-center">
			<div class="col-12 col-lg-10">

				<!-- CARD PRINCIPAL -->
				<div class="card card-hero shadow-sm">

					<!-- HEADER -->
					<div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
						<h5 class="mb-0">
							<i class="fas fa-hand-holding-heart me-2"></i>
							Propuestas de la Etapa
						</h5>

						<a href="{{ url_for('etapa.detalle_etapa', etapa_id=etapa_id, case_id=case_id) }}"
						   class="btn btn-outline-light btn-sm">
							<i class="fas fa-arrow-left me-1"></i>Volver
						</a>
					</div>

					<!-- BODY -->
					<div class="card-body">
						{% if propuestas and propuestas|length > 0 %}
							<div class="table-responsive">
								<table class="table table-hover align-middle">
									<thead class="table-light">
										<tr>
											<th>ID</th>
											<th>Donante</th>
											<th>Monto</th>
											<th>Detalle</th>
											<th>Estado</th>
											<th>Creada</th>
											<th class="text-end">Acciones</th>
										</tr>
									</thead>

									<tbody>
										{% for p in propuestas %}
											<tr class="row-hover">
												<td>{{ p.id }}</td>
												<td>{{ p.donante_nombre if (p.donante_nombre and p.donante_nombre != 'None') else '—' }}</td>
												<td>${{ p.monto if (p.monto is not none) else '—' }}</td>
<td>
    {{
        p.especificacion["items"] | join(", ")
        if p.monto is none and p.especificacion
        else "—"
    }}
</td>
												<td>
													<span class="badge {% if p.estado == 'pending' %}bg-warning text-dark
														{% elif p.estado == 'accepted' %}bg-success
														{% else %}bg-secondary{% endif %}">
														{{ p.estado }}
													</span>
												</td>
												<td>{{ p.created_at[:10] }}</td>
												<td class="text-end">
													<div class="d-flex justify-content-end">
														{% if p.estado == 'pending' %}
														<a href="{{ url_for('donacion.aceptar_propuesta', propuesta_id=p.id, etapa_id=etapa_id, case_id=case_id, propuestas=propuestas) }}"
														   class="btn btn-success btn-sm" onclick="confirmarAceptar(this.href); return false;">
															<i class="fas fa-check me-1"></i> Aceptar
														</a>
														{% else %}
															<span class="text-muted">—</span>
														{% endif %}
													</div>
												</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							</div>

						{% else %}
							<div class="text-center py-5">
								<i class="fas fa-info-circle fa-2x text-muted"></i>
								<p class="mt-3 text-muted">No hay propuestas registradas para esta etapa.</p>
							</div>
						{% endif %}
					</div>

				</div> <!-- end card -->
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
function confirmarAceptar(url) {
    Swal.fire({
        title: '¿Aceptar propuesta?',
        text: 'Esta acción confirmará la donación seleccionada.',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Sí, aceptar',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            window.location.href = url;
        }
    });
}
</script>

</body>
</html>
